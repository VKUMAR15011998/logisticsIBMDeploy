sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/Token","sap/m/MessageToast","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,s,a,o,r,n,c,l){"use strict";var d="Draft - BL";var h="Final - BL";return e.extend("projectlnc.controller.Part_4",{onInit:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("ImportLRF").attachPatternMatched(this._onObjectMatched,this);var i=new t;i.loadData({});this.getView().setModel(i,"docs");var i=new t;i.loadData("model/docs.json");this.getView().setModel(i,"docs_list")},onAfterRendering:function(){const e=[];var t=this.getView().getModel("lrf").oData.ID;console.log(t);t=t.replace(/([0-z]{8})([0-z]{4})([0-z]{4})([0-z]{4})([0-z]{12})/,"$1-$2-$3-$4-$5");e.push(new c("per_Adani_Logistics_LRF_Master_LRF_Master_ID",l.EQ,t));const i=this.byId("dcheck_3");const s=i.getBinding("items");s.filter(e);const a=this.byId("fcheck_3");const o=a.getBinding("items");o.filter(e);e.push(new c("fileName",l.Contains,"check_1"));const r=this.byId("check_1");const n=r.getBinding("items");n.filter(new c(e,true));e.pop();e.push(new c("fileName",l.Contains,"check_2"));const d=this.byId("check_2");const h=d.getBinding("items");h.filter(new c(e,true));e.pop();e.push(new c("fileName",l.Contains,"check_3"));const _=this.byId("check_3");const f=_.getBinding("items");f.filter(new c(e,true))},_onObjectMatched:function(e){},radio_check:function(e,t){var i=e.getSource().getButtons()[e.getParameter("selectedIndex")].getText();this.getView().getModel("lrf").oData["check"+t]=i;if(i=="No"){this.getView().byId("check_"+t).setVisible(false);this.getView().byId("btn_check_"+t).setVisible(false);this.getView().byId("txt_check_"+t).setVisible(false)}else{this.getView().byId("check_"+t).setVisible(true);this.getView().byId("btn_check_"+t).setVisible(true);this.getView().byId("txt_check_"+t).setVisible(true)}},onSelectItem_draft:function(e){if(e.getSource().getSelectedItem().getText()==="Others"){this.getView().byId("other_draft").setVisible(true)}else{this.getView().byId("other_draft").setVisible(false)}d="Draft - "+e.getSource().getSelectedItem().getText();this.getView().byId("dcheck_3").setVisible(true)},onSelectItem_final:function(e){if(e.getSource().getSelectedItem().getText()==="Others"){this.getView().byId("other_final").setVisible(true)}else{this.getView().byId("other_final").setVisible(false)}h="Final - "+e.getSource().getSelectedItem().getText();this.getView().byId("fcheck_3").setVisible(true)},onAfterItemAdded:function(e,t){var i=e.getParameter("item");var s=e.mParameters.item.getFileName();if(t==="dcheck_3"||t==="fcheck_3"){if(t=="dcheck_3"&&d.includes("Others")&&d.includes("Draft")){if(this.getView().byId("other_draft").getValue()==""){this.getView().byId("other_draft").setValueState("Error");return}else{this.getView().byId("other_draft").setValueState("None");var a="Draft - "+this.getView().byId("other_draft").getValue()+" - "+s}}else if(t=="fcheck_3"&&h.includes("Others")&&h.includes("Final")){if(this.getView().byId("other_final").getValue()==""){this.getView().byId("other_final").setValueState("Error");return}else{this.getView().byId("other_final").setValueState("None");var a="Final - "+this.getView().byId("other_final").getValue()+" - "+s}}else{if(t==="dcheck_3")var a=d+" - "+s;else var a=h+" - "+s}}else{var a=t+" - "+s}e.mParameters.item.setFileName(a);this._createEntity(i,t).then(e=>{this._uploadContent(i,e,t)}).catch(e=>{console.log(e)})},onUploadCompleted:function(e,t){var i=this.byId(t);i.removeAllIncompleteItems();i.getBinding("items").refresh();if(t!="dcheck_3"&&t!="fcheck_3")i.setUploadEnabled(false)},_createEntity:function(e,t){var i;var s=this.getView().getModel("lrf").oData.ID;if(t=="dcheck_3"){i="/odata/v4/logistics-/per_Adani_Logistics_LRF_Master("+s+")/To_Draft"}else if(t=="fcheck_3"){i="/odata/v4/logistics-/per_Adani_Logistics_LRF_Master("+s+")/To_Final"}else{i="/odata/v4/logistics-/per_Adani_Logistics_LRF_Master("+s+")/To_CkeckList"}var a=a={mediaType:e.getMediaType(),fileName:e.getFileName()};var o={url:i,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(a)};return new Promise((e,i)=>{$.ajax(o).done((i,s,a)=>{if(t=="dcheck_3"){e(i.Draft_ID)}else if(t=="fcheck_3"){e(i.Final_ID)}else{e(i.Check_ID)}}).fail(e=>{i(e);console.log("rrr")})})},_uploadContent:function(e,t,i){var s=this.getView().getModel("lrf").oData.ID;var a;if(i=="dcheck_3"){a=`/odata/v4/logistics-/per_Adani_Logistics_LRF_Master(`+s+`)/To_Draft(${t})/content`}else if(i=="fcheck_3"){a=`/odata/v4/logistics-/per_Adani_Logistics_LRF_Master(`+s+`)/To_Final(${t})/content`}else{a=`/odata/v4/logistics-/per_Adani_Logistics_LRF_Master(`+s+`)/To_CkeckList(${t})/content`}e.setUploadUrl(a);var o=this.byId(i);o.setHttpRequestMethod("PUT");o.uploadItem(e)},onOpenPressed:function(e){e.preventDefault();var t=e.getSource();this._fileName=t.getFileName();this._download(t).then(e=>{var t=window.URL.createObjectURL(e);var i=document.createElement("a");i.href=t;i.setAttribute("download",this._fileName);document.body.appendChild(i);i.click();document.body.removeChild(i)}).catch(e=>{console.log(e)})},_download:function(e){var t={url:e.getUrl(),method:"GET",xhrFields:{responseType:"blob"}};return new Promise((e,i)=>{$.ajax(t).done((t,i,s)=>{e(t)}).fail(e=>{i(e)})})},onRemovePressed:function(e,t){e.preventDefault();var i=e.getSource();var s=i.getUrl().split("(")[1].split(")")[0];var a=this.byId(t);a.setHttpRequestMethod("PUT");a.removeItem(i);var o;var r=this;if(t=="dcheck_3"){o=`/odata/v4/logistics-/PAdani_Logistics_Draft/${s}`}else if(t=="fcheck_3"){o=`/odata/v4/logistics-/PAdani_Logistics_Final/${s}`}else{o=`/odata/v4/logistics-/PAdani_Logistics_Check_List/${s}`}console.log(o);var n={url:o,method:"DELETE",headers:{"Content-type":"application/json"}};return new Promise((e,i)=>{$.ajax(n).done((i,s,a)=>{if(t=="dcheck_3"){e(i.Draft_ID)}else if(t=="fcheck_3"){e(i.Final_ID)}else{r.byId(t).setUploadEnabled(true);e(i.Check_ID)}}).fail(e=>{i(e)})})},cEmptyFinal:function(){if(this.getView().byId("other_final").getValue()==""){this.getView().byId("other_final").setValueState("Error")}else{this.getView().byId("other_final").setValueState("None")}},cEmpty:function(){if(this.getView().byId("other_draft").getValue()==""){this.getView().byId("other_draft").setValueState("Error")}else{this.getView().byId("other_draft").setValueState("None")}}})});