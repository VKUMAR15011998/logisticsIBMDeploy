sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/Token","sap/m/MessageToast","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/m/MessageBox"],function(e,t,r,s,a,o,i,l){"use strict";var n="/per_Adani_Logistics_LRF_Master";return e.extend("projectlnc.controller.View1",{onInit:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("ImportLRF").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var r={ID:"",p2:"",p3:"",requision_date:new Date,po_no:"",ref_lrf:"None",Lrf_No:"",init_name:"bhavin",vendor_name:"bhavin",project:"",init_mobile:"",add_mobile:"",country_code:"",add_country_code:"",emails:[],init_email:"bhavin.email@ibm.com",ready_date:new Date,vhicle_type:[],pack_type:[],address:"Yes",contact:"Yes",org_add:"Rajkot, India",org_new_add:"",country:"",inco_terms:"",discharge_port_name:"",load_port_name:"",delivery_terms:"FAS",new_cpname:"",new_c_mobile_no:"",new_cpemail:"",new_c_country_code:"",containers:"",h20:"0",f20:"0",o20:"0",g20:"0",h40:"0",f40:"0",o40:"0",g40:"0",check1:"No",check2:"No",check3:"No",check4:"No",check5:"No",check6:"No",req:"",remark:"",material:[],total_qty:"",total_net:"",total_gross:"",submit:"No"};if(e.getParameter("arguments").lrftype==="None"&&e.getParameter("arguments").refno!=="None"){var s=this;var a=this.getView().getModel();var o=new Array;var i=new sap.ui.model.Filter("Lrf_No",sap.ui.model.FilterOperator.Contains,e.getParameter("arguments").refno);o.push(i);a.read(n,{filters:o,urlParameters:{$expand:"To_MaterialDesc,To_CkeckList"},success:function(a){console.log(a);r={ID:"",p2:"",p3:"",requision_date:a["results"][0].Requ_Date,po_no:a["results"][0].PO_Number,ref_lrf:e.getParameter("arguments").refno,Lrf_No:"",init_name:a["results"][0].Initiator_Name,vendor_name:a["results"][0].Vendor_Name,project:a["results"][0].Project_ID,init_mobile:a["results"][0].Mobile_No,add_mobile:a["results"][0].Additional_Mob,country_code:a["results"][0].Country_code,add_country_code:a["results"][0].Add_Country_code,init_email:a["results"][0].Email_Id,emails:a["results"][0].Additional_MailID,ready_date:a["results"][0].Ship_ReadDate,vhicle_type:a["results"][0].TypeOfVehicle,pack_type:a["results"][0].Packing_Type,address:a["results"][0].Address_radio,contact:a["results"][0].Contact_radio,org_add:a["results"][0].Origin_address,org_new_add:a["results"][0].Origin_new_address,country:a["results"][0].Address_country,inco_terms:a["results"][0].Act_Incoterms,discharge_port_name:a["results"][0].NameOfDisPort,load_port_name:a["results"][0].TypeOfLoadPort,delivery_terms:a["results"][0].PO_Inco_Terms,new_cpname:a["results"][0].Ship_Cont_Name,new_c_mobile_no:a["results"][0].Ship_Cont_No,new_cpemail:a["results"][0].Ship_Email_ID,new_c_country_code:a["results"][0].Ship_Country_code,containers:a["results"][0].Contanarised,h20:a["results"][0].C20_HighCube,f20:a["results"][0].C20_FlatRack,o20:a["results"][0].C20_OpenTop,g20:a["results"][0].C20_GeneralPurpose,h40:a["results"][0].C40_HighCube,f40:a["results"][0].C40_FlatRack,o40:a["results"][0].C40_OpenTop,g40:a["results"][0].C40_GeneralPurpose,req:a["results"][0].Sp_Req,remark:a["results"][0].Remarks,total_qty:a["results"][0].TotalPackage,total_net:a["results"][0].TotalNetWeight,total_gross:a["results"][0].TotalGrossWeight,check1:a["results"][0].Check1,check2:a["results"][0].Check2,check3:a["results"][0].Check3,check4:a["results"][0].Check4,check5:a["results"][0].Check5,check6:a["results"][0].Check6,submit:"No",material:a["results"][0].To_MaterialDesc.results};var o=new t(r);s.getView().setModel(o,"lrf")},error:function(e){console.log(e)}})}else if(e.getParameter("arguments").lrftype!=="None"){var s=this;var a=this.getView().getModel();var o=new Array;var i=new sap.ui.model.Filter("Lrf_No",sap.ui.model.FilterOperator.Contains,e.getParameter("arguments").lrftype);o.push(i);a.read(n,{filters:o,urlParameters:{$expand:"To_MaterialDesc,To_CkeckList"},success:function(e){console.log(e);r={ID:e["results"][0].LRF_Master_ID,requision_date:e["results"][0].Requ_Date,po_no:e["results"][0].PO_Number,ref_lrf:e["results"][0].Ref_Lrf_No,Lrf_No:e["results"][0].Lrf_No,init_name:e["results"][0].Initiator_Name,vendor_name:e["results"][0].Vendor_Name,project:e["results"][0].Project_ID,init_mobile:e["results"][0].Mobile_No,add_mobile:e["results"][0].Additional_Mob,country_code:e["results"][0].Country_code,add_country_code:e["results"][0].Add_Country_code,init_email:e["results"][0].Email_Id,emails:e["results"][0].Additional_MailID,ready_date:e["results"][0].Ship_ReadDate,vhicle_type:e["results"][0].TypeOfVehicle,pack_type:e["results"][0].Packing_Type,address:e["results"][0].Address_radio,contact:e["results"][0].Contact_radio,org_add:e["results"][0].Origin_address,org_new_add:e["results"][0].Origin_new_address,country:e["results"][0].Address_country,inco_terms:e["results"][0].Act_Incoterms,discharge_port_name:e["results"][0].NameOfDisPort,load_port_name:e["results"][0].TypeOfLoadPort,delivery_terms:e["results"][0].PO_Inco_Terms,new_cpname:e["results"][0].Ship_Cont_Name,new_c_mobile_no:e["results"][0].Ship_Cont_No,new_cpemail:e["results"][0].Ship_Email_ID,new_c_country_code:e["results"][0].Ship_Country_code,containers:e["results"][0].Contanarised,h20:e["results"][0].C20_HighCube,f20:e["results"][0].C20_FlatRack,o20:e["results"][0].C20_OpenTop,g20:e["results"][0].C20_GeneralPurpose,h40:e["results"][0].C40_HighCube,f40:e["results"][0].C40_FlatRack,o40:e["results"][0].C40_OpenTop,g40:e["results"][0].C40_GeneralPurpose,req:e["results"][0].Sp_Req,remark:e["results"][0].Remarks,total_qty:e["results"][0].TotalPackage,total_net:e["results"][0].TotalNetWeight,total_gross:e["results"][0].TotalGrossWeight,submit:e["results"][0].Submit_Flag,check1:e["results"][0].Check1,check2:e["results"][0].Check2,check3:e["results"][0].Check3,check4:e["results"][0].Check4,check5:e["results"][0].Check5,check6:e["results"][0].Check6,material:e["results"][0].To_MaterialDesc.results};if(e["results"][0].Address_country!=""){r["p2"]="X"}if(e["results"][0].total_qty!=""){r["p3"]="X"}console.log(e["results"][0]);console.log(r);var a=new t(r);s.getView().setModel(a,"lrf")},error:function(e){console.log(e)}})}else{var a=new t(r);this.getView().setModel(a,"lrf")}},checkVal:function(e){var t=e.getParameter("previousKey");var r=e.getSource().getSelectedKey();switch(r){case"one":break;case"two":if(!this.validate_one()){this.go1();l.error("Kindly fill all mendatory data and then press 'Next' button.")}break;case"three":if(!this.validate_one()){this.go1();l.error("Kindly fill all mendatory data and then press 'Next' button.")}else if(!this.validate_two()){this.go2();l.error("Kindly fill all mendatory data and then press 'Next' button.")};break;case"four":if(!this.validate_one()){this.go1();l.error("Kindly fill all mendatory data and then press 'Next' button.")}else if(!this.validate_two()){this.go2();l.error("Kindly fill all mendatory data and then press 'Next' button.")}else if(!this.validate_three()){this.go3();l.error("Kindly fill all mendatory data and then press 'Next' button.")}break;default:}},validate_one:function(e){var t=0;if(this.getView().byId("subView1").byId("po_no").getValue()===""){this.getView().byId("subView1").byId("po_no").setValueState("Error");t++}if(this.getView().byId("subView1").byId("project").getValue()===""){this.getView().byId("subView1").byId("project").setValueState("Error");t++}if(this.getView().byId("subView1").byId("country_code").getSelectedKey()===""){this.getView().byId("subView1").byId("country_code").setValueState("Error");t++}if(this.getView().byId("subView1").byId("mobile_no").getValue().length<7){this.getView().byId("subView1").byId("mobile_no").setValueState("Error");t++}if(this.getView().byId("subView1").byId("add_country_code").getSelectedKey()===""&&this.getView().byId("subView1").byId("add_mobile_no").getValue()!==""){this.getView().byId("subView1").byId("add_country_code").setValueState("Error");if(this.getView().byId("subView1").byId("add_mobile_no").getValue().length<7)this.getView().byId("subView1").byId("add_mobile_no").setValueState("Error");t++}if(this.getView().byId("subView1").byId("add_country_code").getSelectedKey()!==""&&this.getView().byId("subView1").byId("add_mobile_no").getValue()===""){this.getView().byId("subView1").byId("add_mobile_no").setValueState("Error");t++}if(t){return false}else{return true}},validate_two:function(e){var t=0;if(this.getView().byId("subView2").byId("ready_date").getDateValue()==null){this.getView().byId("subView2").byId("ready_date").setValueState("Error");t++}if(this.getView().byId("subView2").byId("country").getSelectedKey()==""){this.getView().byId("subView2").byId("country").setValueState("Error");t++}if(this.getView().byId("subView2").byId("pack_type").getSelectedKeys().length==0){this.getView().byId("subView2").byId("pack_type").setValueState("Error");t++}if(this.getView().byId("subView2").byId("inco_terms").getSelectedKey()==""){this.getView().byId("subView2").byId("inco_terms").setValueState("Error");t++}if(this.getView().byId("subView2").byId("load_port").getSelectedKey()==""){this.getView().byId("subView2").byId("load_port").setValueState("Error");t++}if(this.getView().byId("subView2").byId("discharge_port_name").getSelectedKey()==""){this.getView().byId("subView2").byId("discharge_port_name").setValueState("Error");t++}if(this.getView().byId("subView2").byId("vhicle_type").getSelectedKeys().length==0){this.getView().byId("subView2").byId("vhicle_type").setValueState("Error");t++}if(this.getView().byId("subView2").byId("origin_address").getSelectedButton().getText()=="No"&&this.getView().byId("subView2").byId("org_new_add").getValue()==""){this.getView().byId("subView2").byId("org_new_add").setValueState("Error");t++}if(this.getView().byId("subView2").byId("contact_person").getSelectedButton().getText()=="No"&&this.getView().byId("subView2").byId("new_cpname").getValue()==""){this.getView().byId("subView2").byId("new_cpname").setValueState("Error");t++}if(this.getView().byId("subView2").byId("contact_person").getSelectedButton().getText()=="No"&&this.getView().byId("subView2").byId("new_c_country_code").getSelectedKey()==""){this.getView().byId("subView2").byId("new_c_country_code").setValueState("Error");t++}if(this.getView().byId("subView2").byId("contact_person").getSelectedButton().getText()=="No"&&this.getView().byId("subView2").byId("new_c_mobile_no").getValue().length<7){this.getView().byId("subView2").byId("new_c_mobile_no").setValueState("Error");t++}if(this.getView().byId("subView2").byId("contact_person").getSelectedButton().getText()=="No"&&!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.getView().byId("subView2").byId("new_cpemail").getValue())){this.getView().byId("subView2").byId("new_cpemail").setValueState("Error");t++}if(t){return false}else{return true}},validate_three:function(e){var t=this.getView().getModel("lrf").oData["material"];var r=0;for(let e in Object.keys(t)){for(let s in t[e]){if(t[e][s]==""&&s!="Remarks"){r++;break}if(s=="TypeOfPacking"&&!["Loose Material","Bare","Gunny Bag","Wooden Package","Pallets","Skid","Drums"].includes(t[e][s])){r++;break}}}if(r||t.length<1)return false;else return true},validate_four:function(e){var t=0;if(this.getView().byId("subView4").byId("radio_1").getSelectedButton().getText()=="Yes"&&this.getView().byId("subView4").byId("check_1").getItems().length==0){t++}if(this.getView().byId("subView4").byId("radio_2").getSelectedButton().getText()=="Yes"&&this.getView().byId("subView4").byId("check_2").getItems().length==0){t++}if(this.getView().byId("subView4").byId("radio_3").getSelectedButton().getText()=="Yes"&&this.getView().byId("subView4").byId("check_3").getItems().length==0){t++}if(t){return false}else{return true}},go1:function(){this.getView().byId("iconTabBar").setSelectedKey("one")},go2:async function(){var e=this.validate_one();if(e){this.getView().byId("two").setEnabled(true);var r=this;var s=this.getView().getModel();var a=this.getView().getModel("lrf").oData;var o={Submit_Flag:"No",PO_Number:a["po_no"],Ref_Lrf_No:a["ref_lrf"],Project_ID:a["project"],Additional_MailID:a["emails"],Requ_Date:a["requision_date"].toLocaleDateString("en-CA"),Vendor_Name:a["vendor_name"],Initiator_Name:a["init_name"],Mobile_No:a["init_mobile"],Country_code:a["country_code"],Add_Country_code:a["add_country_code"],Additional_Mob:a["add_mobile"],Email_Id:a["init_email"]};console.log(a);console.log(o);if(a["Lrf_No"]==""){const e=await new Promise((e,i)=>{s.create(n,o,{success:function(s,o){a["ID"]=s.LRF_Master_ID;a["Lrf_No"]=s.Lrf_No;var i=new t(a);r.getView().setModel(i,"lrf");console.log(r.getView().getModel("lrf").oData);e(s)},error:function(t){console.log(t);alert(t);e(t)}})})}else{var i=s.sServiceUrl;var d=n;var _=a["ID"];var c=i+d+"/"+_;jQuery.ajax({url:c,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(o),success:function(){console.log("PATCH request successful")},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}})}this.getView().byId("two").setEnabled(true);this.getView().byId("iconTabBar").setSelectedKey("two")}else{l.error("Kindly fill all mendatory data and then press 'Next' button.")}},go3:function(){var e=this.validate_two();if(e){this.getView().byId("three").setEnabled(true);var r=this.getView().getModel();var s=this.getView().getModel("lrf").oData;var a={Submit_Flag:"No",Lrf_No:s["Lrf_No"],LRF_Master_ID:s["ID"],Ship_ReadDate:s["ready_date"].toLocaleDateString("en-CA"),Shipment_Type:"",Packing_Type:s["pack_type"],Origin_address:"PO Address",Origin_new_address:s["org_new_add"],Address_country:s["country"],C20_HighCube:parseInt(s["h20"]),C20_FlatRack:parseInt(s["f20"]),C20_OpenTop:parseInt(s["o20"]),C20_GeneralPurpose:parseInt(s["g20"]),C40_HighCube:parseInt(s["h40"]),C40_FlatRack:parseInt(s["f40"]),C40_OpenTop:parseInt(s["o40"]),C40_GeneralPurpose:parseInt(s["g40"]),PO_Inco_Terms:s["delivery_terms"],Act_Incoterms:s["inco_terms"],TypeOfVehicle:s["vhicle_type"],TypeOfLoadPort:s["load_port_name"],NameOfDisPort:s["discharge_port_name"],Address_radio:s["address"],Contact_radio:s["contact"],Contanarised:s["containers"]};if(s["contact"]==="Yes"){a["Ship_Cont_Name"]=s["init_name"];a["Ship_Cont_No"]=s["init_mobile"];a["Ship_Country_code"]=s["country_code"];a["Ship_Email_ID"]=s["init_email"]}else{a["Ship_Cont_Name"]=s["new_cpname"];a["Ship_Cont_No"]=s["new_c_mobile_no"];a["Ship_Country_code"]=s["new_c_country_code"];a["Ship_Email_ID"]=s["new_cpemail"]}console.log(s);console.log(a);var o=this;var i=r.sServiceUrl;var d=n;var _=s["ID"];var c=i+d+"/"+_;jQuery.ajax({url:c,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(a),success:function(){console.log("PATCH request successful");s["p2"]="X";var e=new t(s);o.getView().setModel(e,"lrf")},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}});console.log(this.getView().getModel("lrf").oData);this.getView().byId("three").setEnabled(true);this.getView().byId("iconTabBar").setSelectedKey("three")}else{l.error("Kindly fill all mendatory data and then press 'Next' button.")}},go4:function(){var e=this.validate_three();if(e){this.getView().byId("four").setEnabled(true);var r=this.getView().getModel();var s=this.getView().getModel("lrf").oData;var a=JSON.parse(JSON.stringify(s));var o=a.material;o=o.map(function(e){e["PackageNo"]=parseInt(e["PackageNo"]);e["Length"]=parseInt(e["Length"]);e["Width"]=parseInt(e["Width"]);e["Height"]=parseInt(e["Height"]);e["QtyInNumbers"]=parseInt(e["QtyInNumbers"]);e["PerPackNetWeight"]=parseInt(e["PerPackNetWeight"]);e["PerPackGrossWeight"]=parseInt(e["PerPackGrossWeight"]);delete e["MatID"];delete e["__metadata"];delete e["Adani_Logistics_LRF_Master"];delete e["Adani_Logistics_LRF_Master_LRF_Master_ID"];if(e["per_Adani_Logistics_LRF_Master"])delete e["per_Adani_Logistics_LRF_Master"];return e});var i={Submit_Flag:"No",Lrf_No:s["Lrf_No"],LRF_Master_ID:s["ID"],To_MaterialDesc:o,TotalNetWeight:s["total_net"],TotalGrossWeight:s["total_gross"],TotalPackage:s["total_qty"]};var d=this;var _=r.sServiceUrl;var c=n;var u=s["ID"];var g=_+c+"/"+u;console.log(i);jQuery.ajax({url:g,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(i),success:function(){console.log("PATCH request successful");s["p3"]="X";var e=new t(s);d.getView().setModel(e,"lrf")},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}});console.log(this.getView().getModel("lrf").oData);this.getView().byId("four").setEnabled(true);this.getView().byId("iconTabBar").setSelectedKey("four")}else{l.error("Kindly fill all mendatory data and then press 'Next' button.")}},onSubmit:function(){console.log(this.getView().getModel("lrf").oData);var e=this.validate_four();if(e){var t=this.getView().getModel();var r=this.getView().getModel("lrf").oData;var s={Submit_Flag:"YES",Lrf_No:r["Lrf_No"].split("Temp-")[1],LRF_Master_ID:r["ID"],Sp_Req:r["req"],Remarks:r["remark"],Check1:r["check1"],Check2:r["check2"],Check3:r["check3"],Check4:r["check4"],Check5:r["check5"],Check6:r["check6"]};console.log(r);console.log(s);var a=this;var o=t.sServiceUrl;var i=n;var d=r["ID"];var _=o+i+"/"+d;jQuery.ajax({url:_,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(s),success:function(e){console.log("PATCH request successful");l.success("Successfully Generated LRF.");window.open(window.location.href.split("#")[0],"_self")},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}})}else{l.error("Kindly fill all mendatory data and then press 'Next' button.")}}})});