sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,o,n,r){"use strict";var i="Freight Certificate";return e.extend("lrftracker.controller.FFDetails",{onInit:function(){const e=this.getOwnerComponent().getRouter();e.getRoute("FFDetails").attachPatternMatched(this._onRouteMatched,this);this.getOwnerComponent().getModel("objectModel");var a=new t({ff_docs_nos:[{Key:"Freight Certificate",Name:"Freight Certificate"},{Key:"Vessel Certificate",Name:"Vessel Certificate"},{Key:"Marine Certificate",Name:"Marine Certificate"},{Key:"Others",Name:"Others"}]});this.getView().setModel(a,"ff_docs_list");var a=new t;a.loadData("model/vhicle.json");this.getView().setModel(a,"vh_list")},_onRouteMatched:async function(e){var a=e.getParameter("arguments").LRF_Master_ID;var o=e.getParameter("arguments").Lrf_No;var i=this.getOwnerComponent().getModel().sServiceUrl;i=i+"/per_Adani_Logistics_LRF_Master(guid'"+a+"')";await jQuery.ajax({url:i+"?$expand=To_PackingDoc,To_MaterialDesc,To_CkeckList,To_Draft,To_Final,To_DeliveryDetails,To_FF_Shipment,To_FF_Documents",method:"GET",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},success:function(e){var t=new sap.ui.model.json.JSONModel(e.d);this.getOwnerComponent().setModel(t,"objectModel");sap.ui.getCore().setModel(t,"objectModel")}.bind(this),error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}.bind(this)});const _=[];var l=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID;l=l.replace(/([0-z]{8})([0-z]{4})([0-z]{4})([0-z]{4})([0-z]{12})/,"$1-$2-$3-$4-$5");_.push(new n("per_Adani_Logistics_LRF_Master_LRF_Master_ID",r.EQ,l));const s=this.byId("ff_docs");const D=s.getBinding("items");D.filter(_);var c;var d=sap.ui.getCore().getModel("objectModel").getData().FF_Allocation_Date!==null?new Date(parseInt(sap.ui.getCore().getModel("objectModel").getData().FF_Allocation_Date.replace(/\D/g,""))):null;if(sap.ui.getCore().getModel("objectModel").getData().To_FF_Shipment==undefined){c=new t({Allocation_Date:d,lines_name:sap.ui.getCore().getModel("objectModel").getData().FF_AssignEmail_Id})}else{var g=sap.ui.getCore().getModel("objectModel").getData().To_FF_Shipment;c=new t({lines_name:sap.ui.getCore().getModel("objectModel").getData().FF_AssignEmail_Id,Foriegn_Agent_Details:g.Foriegn_Agent_Details,Trans_Dir:g.Trans_Dir,No_Containers:g.No_Containers,Vessel_Name:g.Vessel_Name,Ship_Mode:g.Ship_Mode,Courier_Name:g.Courier_Name,Docket_No:g.Docket_No,Docket_Date:g.Docket_Date!==null?new Date(parseInt(g.Docket_Date.replace(/\D/g,""))):null,BL_No:g.BL_No,Allocation_Date:d,BL_Rel_Date:g.BL_Rel_Date!==null?new Date(parseInt(g.BL_Rel_Date.replace(/\D/g,""))):null,ETD_Plan:g.ETD_Plan!==null?new Date(parseInt(g.ETD_Plan.replace(/\D/g,""))):null,ETA_Plan:g.ETA_Plan!=null?new Date(parseInt(g.ETA_Plan.replace(/\D/g,""))):null,Delivery_Date:g.Delivery_Date!=null?new Date(parseInt(g.Delivery_Date.replace(/\D/g,""))):null,Arrival_Date:g.Arrival_Date!=null?new Date(parseInt(g.Arrival_Date.replace(/\D/g,""))):null,LC_Issuing_Bank:g.LC_Issuing_Bank,LC_Control_No:g.LC_Control_No,LC_Expiry_Date:g.LC_Expiry_Date!=null?new Date(parseInt(g.LC_Expiry_Date.replace(/\D/g,""))):null,DEmpty_Container_Pickup:g.DEmpty_Container_Pickup!=null?new Date(parseInt(g.DEmpty_Container_Pickup.replace(/\D/g,""))):null,DContainer_Handed_Over_to_Shipper:g.DContainer_Handed_Over_to_Shipper!=null?new Date(g.DContainer_Handed_Over_to_Shipper):null,DContainer_Stuffing:g.DContainer_Stuffing!=null?new Date(parseInt(g.DContainer_Stuffing.replace(/\D/g,""))):null,DLoaded_Container_Movement_to_Factory:g.DLoaded_Container_Movement_to_Factory!=null?new Date(parseInt(g.DLoaded_Container_Movement_to_Factory.replace(/\D/g,""))):null,DLoaded_Container_Arrival_Terminal:g.DLoaded_Container_Arrival_Terminal!=null?new Date(parseInt(g.DLoaded_Container_Arrival_Terminal.replace(/\D/g,""))):null,DExport_Clearance:g.DExport_Clearance!=null?new Date(parseInt(g.DExport_Clearance.replace(/\D/g,""))):null,DDocument_Cutoff:g.DDocument_Cutoff!=null?new Date(parseInt(g.DDocument_Cutoff.replace(/\D/g,""))):null,DGatein_Cutoff:g.DGatein_Cutoff!=null?new Date(parseInt(g.DGatein_Cutoff.replace(/\D/g,""))):null,DVessel_ETA_at_Origin:g.DVessel_ETA_at_Origin!=null?new Date(parseInt(g.DVessel_ETA_at_Origin.replace(/\D/g,""))):null,DContainer_Loaded_on_Vessel:g.DContainer_Loaded_on_Vessel!=null?new Date(parseInt(g.DContainer_Loaded_on_Vessel.replace(/\D/g,""))):null,DContainer_Offloaded_from_Vessel:g.DContainer_Offloaded_from_Vessel!==null?new Date(parseInt(g.DContainer_Offloaded_from_Vessel.replace(/\D/g,""))):null,FFSubmit:g.FFSubmit})}console.log(c);this.getView().setModel(c,"ff")},onAfterRendering:function(){},onSelectMode:function(e){var t=e.getSource().getButtons()[e.getParameter("selectedIndex")].getText();this.getView().getModel("ff").oData["Trans_Dir"]=t},onSave:function(){var e=this.getView().getModel("ff").oData;console.log(e);var t={Foriegn_Agent_Details:e.Foriegn_Agent_Details,Trans_Dir:e.Trans_Dir,No_Containers:e.No_Containers,Vessel_Name:e.Vessel_Name,Ship_Mode:e.Ship_Mode,Courier_Name:e.Courier_Name,Docket_No:e.Docket_No,BL_No:e.BL_No,LC_Issuing_Bank:e.LC_Issuing_Bank,LC_Control_No:e.LC_Control_No};if(e.Docket_Date)t["Docket_Date"]=e.Docket_Date.toLocaleDateString("en-CA");if(e.BL_Rel_Date)t["BL_Rel_Date"]=e.BL_Rel_Date.toLocaleDateString("en-CA");if(e.ETD_Plan)t["ETD_Plan"]=e.ETD_Plan.toLocaleDateString("en-CA");if(e.ETA_Plan)t["ETA_Plan"]=e.ETA_Plan.toLocaleDateString("en-CA");if(e.Delivery_Date)t["Delivery_Date"]=e.Delivery_Date.toLocaleDateString("en-CA");if(e.Arrival_Date)t["Arrival_Date"]=e.Arrival_Date.toLocaleDateString("en-CA");if(e.LC_Expiry_Date)t["LC_Expiry_Date"]=e.LC_Expiry_Date.toLocaleDateString("en-CA");if(e.DEmpty_Container_Pickup)t["DEmpty_Container_Pickup"]=e.DEmpty_Container_Pickup.toLocaleDateString("en-CA");if(e.DContainer_Handed_Over_to_Shipper)t["DContainer_Handed_Over_to_Shipper"]=e.DContainer_Handed_Over_to_Shipper.toLocaleDateString("en-CA");if(e.DContainer_Stuffing)t["DContainer_Stuffing"]=e.DContainer_Stuffing.toLocaleDateString("en-CA");if(e.DLoaded_Container_Movement_to_Factory)t["DLoaded_Container_Movement_to_Factory"]=e.DLoaded_Container_Movement_to_Factory.toLocaleDateString("en-CA");if(e.DLoaded_Container_Arrival_Terminal)t["DLoaded_Container_Arrival_Terminal"]=e.DLoaded_Container_Arrival_Terminal.toLocaleDateString("en-CA");if(e.DExport_Clearance)t["DExport_Clearance"]=e.DExport_Clearance.toLocaleDateString("en-CA");if(e.DDocument_Cutoff)t["DDocument_Cutoff"]=e.DDocument_Cutoff.toLocaleDateString("en-CA");if(e.DGatein_Cutoff)t["DGatein_Cutoff"]=e.DGatein_Cutoff.toLocaleDateString("en-CA");if(e.DVessel_ETA_at_Origin)t["DVessel_ETA_at_Origin"]=e.DVessel_ETA_at_Origin.toLocaleDateString("en-CA");if(e.DContainer_Loaded_on_Vessel)t["DContainer_Loaded_on_Vessel"]=e.DContainer_Loaded_on_Vessel.toLocaleDateString("en-CA");if(e.DContainer_Offloaded_from_Vessel)t["DContainer_Offloaded_from_Vessel"]=e.DContainer_Offloaded_from_Vessel.toLocaleDateString("en-CA");var o={To_FF_Shipment:t};var n=this;var r=this.getView().getModel();var i=r.sServiceUrl;if(sap.ui.getCore().getModel("objectModel").getData().To_FF_Shipment==undefined){var _="/per_Adani_Logistics_LRF_Master";var l=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID}else{var _="/PAdani_Logistics_FF_Ship_Details";var l=sap.ui.getCore().getModel("objectModel").getData().To_FF_Shipment.FF_Ship_ID;o=t}var s=i+_+"(guid'"+l+"')";jQuery.ajax({url:s,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(o),success:async function(){console.log("PATCH request successful");a.success("Successfully Saved data");await new Promise(e=>setTimeout(e,3e3));window.history.go(-1)},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}})},onSubmit:function(){var e=this.getView().getModel("ff").oData;console.log(e);var t={Foriegn_Agent_Details:e.Foriegn_Agent_Details,Trans_Dir:e.Trans_Dir,No_Containers:e.No_Containers,Vessel_Name:e.Vessel_Name,Ship_Mode:e.Ship_Mode,Courier_Name:e.Courier_Name,Docket_No:e.Docket_No,BL_No:e.BL_No,LC_Issuing_Bank:e.LC_Issuing_Bank,LC_Control_No:e.LC_Control_No,FFSubmit:"YES"};if(e.Docket_Date)t["Docket_Date"]=e.Docket_Date.toLocaleDateString("en-CA");if(e.BL_Rel_Date)t["BL_Rel_Date"]=e.BL_Rel_Date.toLocaleDateString("en-CA");if(e.ETD_Plan)t["ETD_Plan"]=e.ETD_Plan.toLocaleDateString("en-CA");if(e.ETA_Plan)t["ETA_Plan"]=e.ETA_Plan.toLocaleDateString("en-CA");if(e.Delivery_Date)t["Delivery_Date"]=e.Delivery_Date.toLocaleDateString("en-CA");if(e.Arrival_Date)t["Arrival_Date"]=e.Arrival_Date.toLocaleDateString("en-CA");if(e.LC_Expiry_Date)t["LC_Expiry_Date"]=e.LC_Expiry_Date.toLocaleDateString("en-CA");if(e.DEmpty_Container_Pickup)t["DEmpty_Container_Pickup"]=e.DEmpty_Container_Pickup.toLocaleDateString("en-CA");if(e.DContainer_Handed_Over_to_Shipper)t["DContainer_Handed_Over_to_Shipper"]=e.DContainer_Handed_Over_to_Shipper.toLocaleDateString("en-CA");if(e.DContainer_Stuffing)t["DContainer_Stuffing"]=e.DContainer_Stuffing.toLocaleDateString("en-CA");if(e.DLoaded_Container_Movement_to_Factory)t["DLoaded_Container_Movement_to_Factory"]=e.DLoaded_Container_Movement_to_Factory.toLocaleDateString("en-CA");if(e.DLoaded_Container_Arrival_Terminal)t["DLoaded_Container_Arrival_Terminal"]=e.DLoaded_Container_Arrival_Terminal.toLocaleDateString("en-CA");if(e.DExport_Clearance)t["DExport_Clearance"]=e.DExport_Clearance.toLocaleDateString("en-CA");if(e.DDocument_Cutoff)t["DDocument_Cutoff"]=e.DDocument_Cutoff.toLocaleDateString("en-CA");if(e.DGatein_Cutoff)t["DGatein_Cutoff"]=e.DGatein_Cutoff.toLocaleDateString("en-CA");if(e.DVessel_ETA_at_Origin)t["DVessel_ETA_at_Origin"]=e.DVessel_ETA_at_Origin.toLocaleDateString("en-CA");if(e.DContainer_Loaded_on_Vessel)t["DContainer_Loaded_on_Vessel"]=e.DContainer_Loaded_on_Vessel.toLocaleDateString("en-CA");if(e.DContainer_Offloaded_from_Vessel)t["DContainer_Offloaded_from_Vessel"]=e.DContainer_Offloaded_from_Vessel.toLocaleDateString("en-CA");var o={To_FF_Shipment:t};var n=this;var r=this.getView().getModel();var i=r.sServiceUrl;if(sap.ui.getCore().getModel("objectModel").getData().To_FF_Shipment==undefined){var _="/per_Adani_Logistics_LRF_Master";var l=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID}else{var _="/PAdani_Logistics_FF_Ship_Details";var l=sap.ui.getCore().getModel("objectModel").getData().To_FF_Shipment.FF_Ship_ID;o=t}var s=i+_+"(guid'"+l+"')";jQuery.ajax({url:s,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(o),success:async function(){console.log("PATCH request successful");a.success("Successfully submitted data");await new Promise(e=>setTimeout(e,3e3));window.history.go(-1)},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}})},onSelectItem:function(e){if(e.getSource().getSelectedItem().getText()==="Others"){this.getView().byId("other_docs").setVisible(true)}else{this.getView().byId("other_docs").setVisible(false)}i=e.getSource().getSelectedItem().getText()},onAfterItemAdded:function(e){var t=e.getParameter("item");var a=e.mParameters.item.getFileName();if(i.includes("Others")){if(this.getView().byId("other_docs").getValue()==""){this.getView().byId("other_docs").setValueState("Error");return}else{this.getView().byId("other_docs").setValueState("None");var o=this.getView().byId("other_docs").getValue()+" - "+a}}else{var o=i+" - "+a}e.mParameters.item.setFileName(o);this._createEntity(t).then(e=>{this._uploadContent(t,e)}).catch(e=>{console.log(e)})},onUploadCompleted:function(e){var t=this.byId("ff_docs");t.removeAllIncompleteItems();t.getBinding("items").refresh()},_createEntity:function(e){var t=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID;var a="/odata/v4/logistics-/per_Adani_Logistics_LRF_Master("+t+")/To_FF_Documents";var o=o={mediaType:e.getMediaType(),fileName:e.getFileName()};var n={url:a,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(o)};return new Promise((e,t)=>{$.ajax(n).done((t,a,o)=>{e(t.FF_DocUpload_ID)}).fail(e=>{t(e);console.log("rrr")})})},_uploadContent:function(e,t){var a=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID;var o=`/odata/v4/logistics-/per_Adani_Logistics_LRF_Master(`+a+`)/To_FF_Documents(${t})/content`;e.setUploadUrl(o);var n=this.byId("ff_docs");n.setHttpRequestMethod("PUT");n.uploadItem(e)},onOpenPressed:function(e){e.preventDefault();var t=e.getSource();this._fileName=t.getFileName();this._download(t).then(e=>{var t=window.URL.createObjectURL(e);var a=document.createElement("a");a.href=t;a.setAttribute("download",this._fileName);document.body.appendChild(a);a.click();document.body.removeChild(a)}).catch(e=>{console.log(e)})},_download:function(e){var t={url:e.getUrl(),method:"GET",xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done((t,a,o)=>{e(t)}).fail(e=>{a(e)})})},onRemovePressed:function(e){e.preventDefault();var t=e.getSource();var a=t.getUrl().split("(")[1].split(")")[0];var o=this.byId("ff_docs");o.setHttpRequestMethod("PUT");o.removeItem(t);var n=this;var r=`/odata/v4/logistics-/PAdani_Logistics_FF_Doc_Upload/${a}`;console.log(r);var i={url:r,method:"DELETE",headers:{"Content-type":"application/json"}};return new Promise((e,t)=>{$.ajax(i).done((t,a,o)=>{e(t.FF_DocUpload_ID)}).fail(e=>{t(e)})})},cEmptyFinal:function(){if(this.getView().byId("other_docs").getValue()==""){this.getView().byId("other_docs").setValueState("Error")}else{this.getView().byId("other_docs").setValueState("None")}},validate_date:function(e,t){if(this.getView().byId(t).getDateValue()==null){this.getView().byId(t).setValueState("Error");return 0}else{this.getView().byId(t).setValueState("None");return 1}}})});