sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,o){"use strict";return e.extend("lrftracker.controller.DeliveryDetails",{onInit:function(){const e=this.getOwnerComponent().getRouter();e.getRoute("DeliveryDetails").attachPatternMatched(this._onRouteMatched,this);var o=new t;o.loadData("model/mob_country_code.json");o.setSizeLimit(300);this.getView().setModel(o,"mo_list")},_onRouteMatched:async function(e){var o=e.getParameter("arguments").LRF_Master_ID;var a=e.getParameter("arguments").Lrf_No;var s=this.getOwnerComponent().getModel().sServiceUrl;s=s+"/per_Adani_Logistics_LRF_Master(guid'"+o+"')";await jQuery.ajax({url:s+"?$expand=To_PackingDoc,To_MaterialDesc,To_CkeckList,To_Draft,To_Final,To_DeliveryDetails,To_FF_Shipment,To_FF_Documents",method:"GET",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},success:function(e){var t=new sap.ui.model.json.JSONModel(e.d);this.getOwnerComponent().setModel(t,"objectModel");sap.ui.getCore().setModel(t,"objectModel")}.bind(this),error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}.bind(this)});var n;if(sap.ui.getCore().getModel("objectModel").getData().To_DeliveryDetails==undefined){n=new t({DAddress_radio:sap.ui.getCore().getModel("objectModel").getData().DAddress_radio})}else{var _=sap.ui.getCore().getModel("objectModel").getData().To_DeliveryDetails;n=new t({DAddress_radio:sap.ui.getCore().getModel("objectModel").getData().DAddress_radio,Site_Address:_.Site_Address,DContact_Person:_.DContact_Person,DContact_No:_.DContact_No,DCountry_code:_.DCountry_code,DEmail_ID:_.DEmail_ID,Ins_Pol_01:_.Ins_Pol_01,Ins_Pol_No1:_.Ins_Pol_No1,Ins_Company1:_.Ins_Company1,Pol_Exp_Date1:_.Pol_Exp_Date1!==null?new Date(parseInt(_.Pol_Exp_Date1.replace(/\D/g,""))):null,Ins_Pol_02:_.Ins_Pol_02,Ins_Pol_No2:_.Ins_Pol_No2,Ins_Company2:_.Ins_Company2,Pol_Exp_Date2:_.Pol_Exp_Date2!==null?new Date(parseInt(_.Pol_Exp_Date2.replace(/\D/g,""))):null,Ins_Pol_03:_.Ins_Pol_03,Ins_Pol_No3:_.Ins_Pol_No3,Ins_Company3:_.Ins_Company3,Pol_Exp_Date3:_.Pol_Exp_Date3!==null?new Date(parseInt(_.Pol_Exp_Date3.replace(/\D/g,""))):null,DSubmit:_.DSubmit})}this.getView().setModel(n,"delivery")},onAfterRendering:function(){},validate_address:function(){if(this.getView().byId("origin_address").getSelectedButton().getText()=="No"&&this.getView().byId("org_new_add").getValue()==""){this.getView().byId("org_new_add").setValueState("Error");return 0}else{this.getView().byId("org_new_add").setValueState("None");return 1}},onSelectAdd:function(e){var t=e.getSource().getButtons()[e.getParameter("selectedIndex")].getText();this.getView().getModel("delivery").oData["DAddress_radio"]=t;if(t=="No"){this.getView().byId("org_add").setVisible(false);this.getView().byId("org_new_add").setVisible(true)}else{this.getView().byId("org_add").setVisible(true);this.getView().byId("org_new_add").setVisible(false)}},validate_date:function(e){if(this.getView().byId("date1").getDateValue()==null){this.getView().byId("date1").setValueState("Error");return 0}else{this.getView().byId("date1").setValueState("None");return 1}},validate_new_cpname:function(){if(this.getView().byId("contact_person").getValue()==""){this.getView().byId("contact_person").setValueState("Error");return 0}else{this.getView().byId("contact_person").setValueState("None");return 1}},validate_new_c_country_code:function(){if(this.getView().byId("c_country_code").getSelectedKey()==""){this.getView().byId("c_country_code").setValueState("Error");return 0}else{this.getView().byId("c_country_code").setValueState("None");return 1}},validate_new_c_mobile_no:function(){if(this.getView().byId("c_mobile_no").getValue().length<7){this.getView().byId("c_mobile_no").setValueState("Error");return 0}else{this.getView().byId("c_mobile_no").setValueState("None");return 1}},validate_new_cpemail:function(){if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.getView().byId("cemail").getValue())){this.getView().byId("cemail").setValueState("Error");return 0}else{this.getView().byId("cemail").setValueState("None");return 1}},onSave:function(){var e=this.getView().getModel("delivery").oData;var t={Site_Address:e.Site_Address,DContact_Person:e.DContact_Person,DCountry_code:e.DCountry_code,DContact_No:e.DContact_No,DEmail_ID:e.DEmail_ID,Ins_Pol_01:e.Ins_Pol_01,Ins_Pol_No1:e.Ins_Pol_No1,Ins_Company1:e.Ins_Company1,Ins_Pol_02:e.Ins_Pol_02,Ins_Pol_No2:e.Ins_Pol_No2,Ins_Company2:e.Ins_Company2,Ins_Pol_03:e.Ins_Pol_03,Ins_Pol_No3:e.Ins_Pol_No3,Ins_Company3:e.Ins_Company3};if(e.Pol_Exp_Date1)t["Pol_Exp_Date1"]=e.Pol_Exp_Date1.toLocaleDateString("en-CA");if(e.Pol_Exp_Date2)t["Pol_Exp_Date2"]=e.Pol_Exp_Date2.toLocaleDateString("en-CA");if(e.Pol_Exp_Date3)t["Pol_Exp_Date3"]=e.Pol_Exp_Date3.toLocaleDateString("en-CA");var a={DAddress_radio:e.DAddress_radio,To_DeliveryDetails:t};var s=this;var n=this.getView().getModel();var _=n.sServiceUrl;if(sap.ui.getCore().getModel("objectModel").getData().To_DeliveryDetails==undefined){var i="/per_Adani_Logistics_LRF_Master";var r=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID}else{var i="/PAdani_Logistics_Delivery_Details";var r=sap.ui.getCore().getModel("objectModel").getData().To_DeliveryDetails.Delivery_ID;a=t}var l=_+i+"(guid'"+r+"')";jQuery.ajax({url:l,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(a),success:async function(){console.log("PATCH request successful");o.success("Successfully saved data");location.reload()},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}})},onSubmit:function(){if(!this.validate_address()||!this.validate_new_cpname()||!this.validate_new_c_country_code()||!this.validate_new_c_mobile_no()||!this.validate_new_cpemail()){this.validate_address();this.validate_new_cpname();this.validate_new_c_country_code();this.validate_new_c_mobile_no();this.validate_new_cpemail();o.error("Kindly fill all mendatory data and then press 'Submit' button.")}else{var e=this.getView().getModel("delivery").oData;var t={Site_Address:e.Site_Address,DContact_Person:e.DContact_Person,DCountry_code:e.DCountry_code,DContact_No:e.DContact_No,DEmail_ID:e.DEmail_ID,Ins_Pol_01:e.Ins_Pol_01,Ins_Pol_No1:e.Ins_Pol_No1,Ins_Company1:e.Ins_Company1,Ins_Pol_02:e.Ins_Pol_02,Ins_Pol_No2:e.Ins_Pol_No2,Ins_Company2:e.Ins_Company2,Ins_Pol_03:e.Ins_Pol_03,Ins_Pol_No3:e.Ins_Pol_No3,Ins_Company3:e.Ins_Company3,DSubmit:"YES"};if(e.Pol_Exp_Date1)t["Pol_Exp_Date1"]=e.Pol_Exp_Date1.toLocaleDateString("en-CA");if(e.Pol_Exp_Date2)t["Pol_Exp_Date2"]=e.Pol_Exp_Date2.toLocaleDateString("en-CA");if(e.Pol_Exp_Date3)t["Pol_Exp_Date3"]=e.Pol_Exp_Date3.toLocaleDateString("en-CA");var a={DAddress_radio:e.DAddress_radio,To_DeliveryDetails:t};var s=this;var n=this.getView().getModel();var _=n.sServiceUrl;if(sap.ui.getCore().getModel("objectModel").getData().To_DeliveryDetails==undefined){var i="/per_Adani_Logistics_LRF_Master";var r=sap.ui.getCore().getModel("objectModel").getData().LRF_Master_ID}else{var i="/PAdani_Logistics_Delivery_Details";var r=sap.ui.getCore().getModel("objectModel").getData().To_DeliveryDetails.Delivery_ID;a=t}var l=_+i+"(guid'"+r+"')";jQuery.ajax({url:l,method:"PATCH",headers:{"Content-Type":"application/json",DataServiceVersion:"2.0","X-CSRF-Token":"Fetch"},data:JSON.stringify(a),success:function(){console.log("PATCH request successful");o.success("Successfully submitted data");location.reload()},error:function(e){console.error("PATCH request failed: "+e.responseText);alert(e.responseText)}})}}})});